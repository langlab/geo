(function(){var e,t=this,n=[].slice;window.w=window,w.ck=window.CoffeeKup,w.wait=function(e,t){return setTimeout(t,e)},w.doEvery=function(e,t){return setInterval(t,e)},w.logging=!0,w.log=function(){var e;e=1<=arguments.length?n.call(arguments,0):[];if(w.logging)return typeof console!="undefined"&&console!==null?console.log.apply(console,e):void 0},window.module=function(e,t,r){var i,s,o,u,a,f;arguments.length<3&&(a=[typeof exports!="undefined"?exports:window].concat(n.call(arguments)),e=a[0],t=a[1],r=a[2]),s=e,f=t.split(".");for(o=0,u=f.length;o<u;o++)i=f[o],e=e[i]||(e[i]={});return r(e,s)},(e=window.filepicker)!=null&&e.setKey("Ag4e6fVtyRNWgXY2t3Dccz")}).call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},n=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},r=function(e,t){return function(){return e.apply(t,arguments)}};module("BB",function(e,i){var s,o,u,a,f;return f=function(e,t,n){return console.log("emitting sync: ",this.syncName,e,t,n),window.sock.emit("api",this.syncName,{method:e,model:t,options:n},function(e,t){return console.log(e,t),e?n.error(t):n.success(t)})},o=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.io=i.io,n.prototype.idAttribute="_id",n.prototype.initialize=function(e){return this.options=e,_.extend(this,this.options),this},n.prototype.sync=f,n.prototype.api=function(e,t,n){return window.sock.emit("api",this.syncName,{method:e,model:this.toJSON(),options:t},n)},n}(Backbone.Model),s=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.io=i.io,r.prototype.initialize=function(e){return this.options=e,_.extend(this,this.options),this},r.prototype.getByIds=function(e){return this.filter(function(t){var r;return r=t.id,n.call(e,r)>=0})},r.prototype.sync=f,r.prototype.api=function(e,t,n){return window.sock.emit("api",this.syncName,{method:e,model:null,options:t},n)},r}(Backbone.Collection),a=function(e){function n(){return this.tts=r(this.tts,this),this.sfx=r(this.sfx,this),n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.io=i.io,n.prototype.initialize=function(e){return this.options=e,_.extend(this,this.options),this},n.prototype.sfx=function(e){var t,n;return t=new Audio,t.src="/sfx/"+e+"."+(Modernizr.audio.mp3?"mp3":"wav"),n=new Popcorn(t),n.play(),n.on("ended",function(){return n.destroy()}),n},n.prototype.tts=function(e){var t,n,r,i,s,o;return r=e.language,n=e.gender,o=e.textToSay,s=e.rate,t=new Audio,t.src="http://tts.langlab.org/"+r+"/"+n+"?text="+o+"&rate="+s,i=new Popcorn(t),i.play(),i.on("ended",function(){return i.destroy()}),i},n.prototype.render=function(){return typeof this.preRender=="function"&&this.preRender(),this.$el.html(ck.render(this.template,this)),typeof this.postRender=="function"&&this.postRender(),this},n.prototype.open=function(e){return e==null&&(e="#main"),this.$el.appendTo(e),this.trigger("open",e),this.isOpen=!0,this},n.prototype.close=function(){return this.unbind(),this.undelegateEvents(),this.remove(),this.trigger("close"),this.isOpen=!1,this},n}(Backbone.View),u=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.initialize=function(e){return this.options=e,_.extend(this,this.options),this},r.prototype.clearViews=function(e){var t,r,i,s;_.isArray(e)||(e=[e]),i=this.views,s=[];for(t in i)r=i[t],n.call(e,t)>=0||s.push(r.close());return s},r}(Backbone.Router),_.extend(e,{Model:o,Collection:s,View:a,Router:u})})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};module("App",function(e,n){var r,i,s,o,u;return r=n.BB,s=function(){function e(){var e=this;this.data={media:new App.Media.Collection},this.views={home:new i},this.routers={main:new o({data:this.data,views:this.views}),media:new App.Media.Router({data:this.data,views:this.views})},this.socketConnect(),this.connection.on("connect",function(){if(!n.Backbone.History.started)return n.Backbone.history.start()})}return e.prototype.name="LangLab",e.prototype.socketConnect=function(){return this.connection=window.sock=window.io.connect("/"),this},e}(),o=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.routes={"":"home"},n.prototype.home=function(){return this.views.home.render().open()},n}(r.Router),u={},i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.className="home-root",n.prototype.template=function(){return div({"class":"row"},function(){return a({"class":"span4 h3",href:"#media"},"Media"),a({"class":"span4 h3",href:"#students"},"Students"),a({"class":"span4 h3",href:"#activities"},"Activities")})},n}(r.View),_.extend(e,{Model:s,Router:o,Views:u})}),$(function(){return window.app=new App.Model})}.call(this),function(){console.log("ui")}.call(this),function(){console.log("welcome")}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},n=function(e,t){return function(){return e.apply(t,arguments)}};window.CFG={S3:{KEY:"AKIAIUJTVW7ZLSILOJRA",SECRET:"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",MEDIA_BUCKET:"geolab-media",URL_ROOT:"https://s3.amazonaws.com/"}},module("App.Media",function(e,r){var i,s,o,u,f;return i=r.BB,o=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.syncName="media",n.prototype.type=function(){return this.get("fpData").type.split("/")[0]},n.prototype.currentProgress=function(){return parseInt(this.get("progress"),10)},n.prototype.thumbnailSrc=function(){return this.type()==="video"?this.currentProgress()<100?"http://lorempixel.com/400/300/abstract/2/PROCESSING%20VIDEO/":""+CFG.S3.URL_ROOT+CFG.S3.MEDIA_BUCKET+"/"+this.get("urlBase")+"_0004.png":"/assets/sound.png"},n.prototype.urlBase=function(){return""+App.Utils.Encode.toHex(this.get("fpData").url)},n.prototype.src=function(){var e;return this.type()==="video"?e=Modernizr.video.webm?"webm":"mp4":e="mp3",""+CFG.S3.URL_ROOT+CFG.S3.MEDIA_BUCKET+"/"+this.get("urlBase")+"."+e},n}(i.Model),s=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.syncName="media",n.prototype.model=o,n.prototype.dbEvent=function(e){var t,n,r,i;t=e.event,r=e.model,i=e.progress;if(t==="progress")return n=this.get(r._id),n.set("progress",i),console.log("updated: ",n)},n.prototype.fetchMyVideo=function(e){var t=this;return e==null&&(e={}),this.api("myVideo",e,function(e,n){return t.reset(n),cb()})},n.prototype.fetchMyAudio=function(e){var t=this;return e==null&&(e={}),this.api("myAudio",e,function(e,n){return t.reset(n),cb()})},n.prototype.fetchSharedVideo=function(e){var t=this;return e==null&&(e={}),e.type="video",this.api("sharedMediaOfType",e,function(e,n){return t.reset(n),cb()})},n}(i.Collection),u=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.initialize=function(e){return this.options=e,_.extend(this,this.options),this.data.media=new s},n.prototype.routes={media:"list","media/:id":"detail"},n.prototype.list=function(){var e=this;return this.clearViews(),this.views.list=new f.List({collection:this.data.media}),this.data.media.fetch({success:function(){return e.views.list.open()}})},n.prototype.detail=function(e){var t=this;return this.clearViews(),this.views.detail=new f.Detail({model:new o({_id:e})}),this.views.detail.model.fetch({success:function(){return t.views.detail.render().open()}})},n}(i.Router),f={},f.IconItem=function(e){function r(){return this.updateProgress=n(this.updateProgress,this),r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.tagName="li",r.prototype.className="span3 media-icon-item",r.prototype.initialize=function(){return this.model.on("change:progress",this.updateProgress)},r.prototype.events={"click .delete":function(){return this.model.destroy()}},r.prototype.updateProgress=function(){return this.model.currentProgress()<100?this.$(".bar").css("width",""+this.model.currentProgress()+"%"):this.render()},r.prototype.template=function(){return span({"class":"thumbnail"},function(){return img({src:""+this.model.thumbnailSrc()}),this.model.currentProgress()<100&&div({"class":"progress progress-striped active progress-warning",style:"height:10px"},function(){return div({"class":"bar",style:"width: "+this.model.currentProgress()+"%"})}),div({"class":"caption"},function(){return a({href:"#media/"+this.model.id},""+this.model.get("title")),span({"class":"icon-trash delete"})})})},r}(i.View),f.List=function(e){function r(){return this.createFromUpload=n(this.createFromUpload,this),r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.tagName="div",r.prototype.className="media-list",r.prototype.initialize=function(){var e=this;return this.collection.on("reset",function(){return e.render()}),this.collection.on("add",function(){return e.render()}),this.collection.on("remove",function(){return e.render()})},r.prototype.events={"click .upload-file":function(){var e;return e={metadata:!0},filepicker.getFile("*/*",e,this.createFromUpload)}},r.prototype.createFromUpload=function(e,t){var n;return n=prompt("Please enter a name for your media:",t.filename),this.collection.create({fpData:t,fpUrl:e,title:n},{wait:!0})},r.prototype.template=function(){return div({"class":"btn-group"},function(){return button({"class":"btn upload-file"},"upload file")}),ul({"class":"thumbnails"},function(){})},r.prototype.render=function(){var e,t,n,i,s;r.__super__.render.call(this),s=this.collection.models;for(n=0,i=s.length;n<i;n++)e=s[n],t=new f.IconItem({model:e}),t.render().open(this.$(".thumbnails"));return this},r}(i.View),f.Detail=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.tagName="div",n.prototype.className="media-detail",n.prototype.initialize=function(){},n.prototype.events={"change [data-field]":"save"},n.prototype.save=function(e){var t,n;return t=$(e.currentTarget).attr("data-field"),n=$(e.currentTarget).val(),this.model.save(t,n)},n.prototype.sharingValues={"private":"Private",colleagues:"Share with my colleagues",everyone:"Share with everyone"},n.prototype.template=function(){return div({"class":"row"},function(){return div({"class":"span6"},function(){return video({controls:"controls",src:""+this.model.src()})}),div({"class":"span6"},function(){return div({"class":"control-group"},function(){return input({"data-field":"title",type:"text",placeholder:"title",value:""+this.model.get("title")})}),div({"class":"control-group"},function(){return select({"data-field":"sharing"},function(){var e,t,n,r;n=this.sharingValues,r=[];for(t in n)e=n[t],r.push(option({selected:""+(this.model.get("sharing")===t?"selected":""),value:""+t},""+e));return r})})})})},n}(i.View),_.extend(e,{Model:o,Collection:s,Router:u,Views:f})}),module("App.YT",function(e,n){var r,i,s;return i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.parse=function(e){var t;return t={id:e.media$group.yt$videoid.$t,duration:e.media$group.yt$duration.seconds,src:e.media$group.media$content[0].url,title:e.media$group.media$title.$t,description:e.media$group.media$description.$t,thumbnail:e.media$group.media$thumbnail[2].url}},n}(Backbone.Model),r=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.url="http://gdata.youtube.com/feeds/api/videos?v=2&alt=json",n.prototype.model=i,n.prototype.parse=function(e){return console.log(e.feed.entry),e.feed.entry},n}(Backbone.Collection),_.extend(e,{Model:i,Collection:r}),s={}})}.call(this),function(){console.log("home")}.call(this)